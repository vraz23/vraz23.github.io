<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Kocer - Heather Place HOA Board Candidate</title>
</head>
<body>
<div style="max-width: 800px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif; line-height: 1.6;">
<h1 style="text-align: center; color: #2c3e50; background-color: #e8f5e8; padding: 15px; border-radius: 5px; margin: 20px 0;">John Kocer – Candidate for Heather Place HOA Board of Directors</h1>
<a href="https://www.amazon.com/dp/B0CLBXYRXB" target="_blank">
<img src="./HOAProblemSolved.jpg" alt="John Kocer Logo" style="display: block; margin: 0 auto; width: 150px; height: auto; cursor: pointer;">
</a>
<div style="background-color: rgba(255, 200, 200, 0.5); color: black; padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center;">
<h2 style="color: black; margin: 0;">FOR IMMEDIATE RELEASE</h2>
<h3 style="color: black; margin: 10px 0;">John Kocer Announces Write-In Candidacy for Heather Place HOA Board of Directors</h3>
<p style="margin: 5px 0;"><em>Technology Executive and HOA Advocate Seeks Community Support Through Unique Write-In Campaign</em></p>
</div>

<div style="background-color: rgba(200, 255, 200, 0.5); color: black; padding: 20px; border-radius: 5px; margin: 20px 0;">
<h2 style="color: black; margin-top: 0;">🚨 How to Support This Campaign ASAP:</h2>
<ol style="font-size: 18px; font-weight: bold;">
<li>Download the Write-In Ballot: <a href="BallotJK2025.pdf" style="color: #2922e6; text-decoration: underline;">BallotJK2025.pdf</a></li>
<li>Write "John Kocer" in the candidate section</li>
<li>Submit by Deadline:Now - ASP  to:
<ul style="margin-top: 10px;">
<li>Email: <a href="mailto:info@pridemgmt.com" style="color: #2922e6; text-decoration: underline;">info@pridemgmt.com</a></li>
<li>Phone: <a href="tel:480-682-3209" style="color: #2922e6; text-decoration: underline;">480-682-3209</a> (for assistance)</li>
</ul>
</li>
</ol>
</div>

<div style="background-color: #3498db; color: white; padding: 15px; border-radius: 5px; margin: 20px 0;">
<h3 style="color: white; margin-top: 0;">Key Platform Points:</h3>
<ul>
<li>Implement transparent governance practices</li>
<li>Reform parking enforcement policies</li>
<li>Apply professional project management to HOA operations</li>
<li>Create clearer channels for homeowner input</li>
</ul>
</div>

<div style="background-color: #e74c3c; color: white; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 5px solid #c0392b;">
<h2 style="color: white; margin-top: 0;">🚫 Why It's Time to Say NO to HOA Control Over Our Streets</h2>
<p style="margin-bottom: 15px; font-weight: bold;">The HOA's control over public roadways means unnecessary restrictions and overreach that limit homeowners' freedom. Here's why losing HOA authority could actually benefit our community:</p>

<ul style="margin: 15px 0;">
<li><strong>Excessive Rules:</strong> HOAs often impose strict parking and traffic rules that are burdensome and unfair to residents and guests.</li>
<li><strong>High Fees and Fines:</strong> HOA enforcement can lead to costly fines and fees for minor or subjective violations.</li>
<li><strong>Lack of Transparency:</strong> HOAs sometimes operate without enough homeowner input or accountability, making decisions that don't reflect the community's best interests.</li>
<li><strong>Limited Personal Freedom:</strong> HOA regulations restrict how homeowners use their own property and streets.</li>
<li><strong>Potential for Dissolving the HOA:</strong> Without control over streets and enforcement, the HOA's power diminishes—opening the door for less bureaucracy and more homeowner independence.</li>
</ul>

<p style="margin: 15px 0; font-weight: bold; background-color: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 3px;">
By allowing the HOA to lose control of public roads, we can reduce unnecessary rules, save money, and regain our freedom as homeowners.
</p>

<p style="margin-bottom: 0; font-size: 18px; font-weight: bold; text-align: center;">
🏠 Let's take back control from the HOA and create a community that respects our rights! 🏠
</p>
</div>

<h2 style="color: #34495e;">Let's Build a Better Community Together</h2>
<p>I'd be honored to serve you on the Board. Your voice matters—let's collaborate to keep Heather Place a welcoming and well-managed neighborhood.</p>

<h3 style="color: #34495e;">Learn More & Connect:</h3>
<p>
<a href="jkPressMedia.html" style="color: #3498db; text-decoration: none;">📰 Press & Media Kit</a><br>
<a href="https://www.amazon.com/s/ref=nb_sb_noss_2?url=search-alias%3Daps&field-keywords=john+kocer" target="_blank" style="color: #3498db; text-decoration: none;">Amazon Author Page</a><br>
<a href="https://www.linkedin.com/in/john-kocer-117a7662/" target="_blank" style="color: #3498db; text-decoration: none;">LinkedIn</a>
</p>

<div style="background-color: rgba(200, 255, 200, 0.5); color: black; padding: 20px; border-radius: 5px; margin: 20px 0;">
<h2 style="color: black; margin-top: 0;">🚨 How to Support This Campaign ASAP:</h2>
<ol style="font-size: 18px; font-weight: bold;">
<li>Download the Write-In Ballot: <a href="BallotJK2025.pdf" style="color: #2922e6; text-decoration: underline;">BallotJK2025.pdf</a></li>
<li>Write "John Kocer" in the candidate section</li>
<li>Submit by Deadline: Now - ASP  to:
<ul style="margin-top: 10px;">
<li>Email: <a href="mailto:info@pridemgmt.com" style="color: #2922e6; text-decoration: underline;">info@pridemgmt.com</a></li>
<li>Phone: <a href="tel:480-682-3209" style="color: #2922e6; text-decoration: underline;">480-682-3209</a> (for assistance)</li>
</ul>
</li>
</ol>
</div>

<div style="background-color: #3498db; color: white; padding: 15px; border-radius: 5px; margin: 20px 0;">
<h3 style="color: white; margin-top: 0;">Key Platform Points:</h3>
<ul>
<li>Implement transparent governance practices</li>
<li>Reform parking enforcement policies</li>
<li>Apply professional project management to HOA operations</li>
<li>Create clearer channels for homeowner input</li>
</ul>
</div>

<div style="background-color: #e74c3c; color: white; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 5px solid #c0392b;">
<h2 style="color: white; margin-top: 0;">🚫 Why It's Time to Say NO to HOA Control Over Our Streets</h2>
<p style="margin-bottom: 15px; font-weight: bold;">The HOA's control over public roadways means unnecessary restrictions and overreach that limit homeowners' freedom. Here's why losing HOA authority could actually benefit our community:</p>

<ul style="margin: 15px 0;">
<li><strong>Excessive Rules:</strong> HOAs often impose strict parking and traffic rules that are burdensome and unfair to residents and guests.</li>
<li><strong>High Fees and Fines:</strong> HOA enforcement can lead to costly fines and fees for minor or subjective violations.</li>
<li><strong>Lack of Transparency:</strong> HOAs sometimes operate without enough homeowner input or accountability, making decisions that don't reflect the community's best interests.</li>
<li><strong>Limited Personal Freedom:</strong> HOA regulations restrict how homeowners use their own property and streets.</li>
<li><strong>Potential for Dissolving the HOA:</strong> Without control over streets and enforcement, the HOA's power diminishes—opening the door for less bureaucracy and more homeowner independence.</li>
</ul>

<p style="margin: 15px 0; font-weight: bold; background-color: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 3px;">
By allowing the HOA to lose control of public roads, we can reduce unnecessary rules, save money, and regain our freedom as homeowners.
</p>

<p style="margin-bottom: 0; font-size: 18px; font-weight: bold; text-align: center;">
🏠 Let's take back control from the HOA and create a community that respects our rights! 🏠
</p>
</div>

<h2 style="color: #34495e;">Let's Build a Better Community Together</h2>
<p>I'd be honored to serve you on the Board. Your voice matters—let's collaborate to keep Heather Place a welcoming and well-managed neighborhood.</p>

<h3 style="color: #34495e;">Learn More & Connect:</h3>
<p>
<a href="jkPressMedia.html" style="color: #3498db; text-decoration: none;">📰 Press & Media Kit</a><br>
<a href="https://www.amazon.com/s/ref=nb_sb_noss_2?url=search-alias%3Daps&field-keywords=john+kocer" target="_blank" style="color: #3498db; text-decoration: none;">Amazon Author Page</a><br>
<a href="https://www.linkedin.com/in/john-kocer-117a7662/" target="_blank" style="color: #3498db; text-decoration: none;">LinkedIn</a>
</p>

<div style="background-color: rgba(200, 255, 200, 0.5); color: black; padding: 20px; border-radius: 5px; margin: 20px 0;">
<h2 style="color: black; margin-top: 0;">🚨 How to Support This Campaign ASAP:</h2>
<ol style="font-size: 18px; font-weight: bold;">
<li>Download the Write-In Ballot: <a href="BallotJK2025.pdf" style="color: #2922e6; text-decoration: underline;">BallotJK2025.pdf</a></li>
<li>Write "John Kocer" in the candidate section</li>
<li>Submit by Deadline: Now - ASP  to:
<ul style="margin-top: 10px;">
<li>Email: <a href="mailto:info@pridemgmt.com" style="color: #2922e6; text-decoration: underline;">info@pridemgmt.com</a></li>
<li>Phone: <a href="tel:480-682-3209" style="color: #2922e6; text-decoration: underline;">480-682-3209</a> (for assistance)</li>
</ul>
</li>
</ol>
</div>

<div style="background-color: #3498db; color: white; padding: 15px; border-radius: 5px; margin: 20px 0;">
<h3 style="color: white; margin-top: 0;">Key Platform Points:</h3>
<ul>
<li>Implement transparent governance practices</li>
<li>Reform parking enforcement policies</li>
<li>Apply professional project management to HOA operations</li>
<li>Create clearer channels for homeowner input</li>
</ul>
</div>

<div style="background-color: #e74c3c; color: white; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 5px solid #c0392b;">
<h2 style="color: white; margin-top: 0;">🚫 Why It's Time to Say NO to HOA Control Over Our Streets</h2>
<p style="margin-bottom: 15px; font-weight: bold;">The HOA's control over public roadways means unnecessary restrictions and overreach that limit homeowners' freedom. Here's why losing HOA authority could actually benefit our community:</p>

<ul style="margin: 15px 0;">
<li><strong>Excessive Rules:</strong> HOAs often impose strict parking and traffic rules that are burdensome and unfair to residents and guests.</li>
<li><strong>High Fees and Fines:</strong> HOA enforcement can lead to costly fines and fees for minor or subjective violations.</li>
<li><strong>Lack of Transparency:</strong> HOAs sometimes operate without enough homeowner input or accountability, making decisions that don't reflect the community's best interests.</li>
<li><strong>Limited Personal Freedom:</strong> HOA regulations restrict how homeowners use their own property and streets.</li>
<li><strong>Potential for Dissolving the HOA:</strong> Without control over streets and enforcement, the HOA's power diminishes—opening the door for less bureaucracy and more homeowner independence.</li>
</ul>

<p style="margin: 15px 0; font-weight: bold; background-color: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 3px;">
// Function to update unique IP count from shared data
function updateUniqueIPCountFromSharedData() {
    try {
        const ipData = JSON.parse(localStorage.getItem('jkCampaignIPData') || '[]');
        const uniqueIPs = [...new Set(ipData.map(visitor => visitor.ip))];
        const countElement = document.getElementById('uniqueIPCount');
        if (countElement) {
            countElement.textContent = `Unique IPs: ${uniqueIPs.length}`;
        }
    } catch (error) {
        console.log('Error updating IP count:', error.message);
        updateUniqueIPCount(); // Fallback to old method
    }
}

// Function to update total visits from shared data
function updateTotalVisitsFromSharedData() {
    try {
        const sharedData = JSON.parse(localStorage.getItem('jkCampaignSharedData') || '{"visits": []}');
        const countElement = document.getElementById('totalVisitsCount');
        if (countElement) {
            countElement.textContent = `Total Visits: ${sharedData.visits.length}`;
        }
    } catch (error) {
        console.log('Error updating total visits count:', error.message);
        const countElement = document.getElementById('totalVisitsCount');
        if (countElement) {
            countElement.textContent = 'Total Visits: 0';
        }
    }
}

// Function to update unique IP count in admin panel
function updateUniqueIPCount() {
    // Use localStorage data first (backward compatibility)
    const visitorData = JSON.parse(localStorage.getItem('visitorTrackingData') || '[]');
    const uniqueIPs = [...new Set(visitorData.map(visitor => visitor.ip))];
    const countElement = document.getElementById('uniqueIPCount');
    if (countElement) {
        countElement.textContent = `Unique IPs: ${uniqueIPs.length}`;
    }
}

// Function to update total visits count from CSV data
async function updateTotalVisitsCount() {
    try {
        // Try localStorage first (most recent data)
        const localData = JSON.parse(localStorage.getItem('csvVisitorCountData') || '[]');
        let visitorData = localData;
        
        // If no local data, try reading CSV file
        if (visitorData.length === 0) {
            visitorData = await readVisitorCSVFile();
        }
        
        const countElement = document.getElementById('totalVisitsCount');
        if (countElement) {
            countElement.textContent = `Total Visits: ${visitorData.length}`;
        }
    } catch (error) {
        console.log('Error updating total visits count:', error.message);
        const countElement = document.getElementById('totalVisitsCount');
        if (countElement) {
            countElement.textContent = 'Total Visits: 0';
        }
    }
}

// Function to download visitor count CSV
function downloadVisitorCountCSV() {
    const sharedData = JSON.parse(localStorage.getItem('jkCampaignSharedData') || '{"visits": []}');
    
    if (sharedData.visits.length === 0) {
        alert('No visitor count data available');
        return;
    }
    
    generateVisitorCSVDownload(sharedData.visits);
}

// Admin function to manually download CSV (for IP data)
window.downloadVisitorCSV = function() {
    const ipData = JSON.parse(localStorage.getItem('jkCampaignIPData') || '[]');
    
    if (ipData.length === 0) {
        alert('No IP data available');
        return;
    }
    
    generateCSVDownloadFromData(ipData);
};

// Function to generate visitor CSV download
function generateVisitorCSVDownload(visitorData) {
    if (visitorData.length === 0) {
        alert('No visitor count data available');
        return;
    }
    
    // Create CSV header
    const csvHeader = 'Timestamp,Date,Time,Hour,Minute,Second,Visit_Count,User_Agent,Page_URL\n';
    
    // Create CSV rows
    const csvRows = visitorData.map(visitor => {
        return [
            visitor.timestamp,
            visitor.date,
            visitor.time,
            visitor.hour,
            visitor.minute,
            visitor.second,
            visitor.visitCount,
            `"${visitor.userAgent}"`, // Wrap in quotes for CSV
            visitor.pageUrl
        ].join(',');
    }).join('\n');
    
    // Combine header and rows
    const csvContent = csvHeader + csvRows;
    
    // Create and trigger download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `visitors_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
async function updateUniqueIPCountFromCSV() {
    try {
        // Try localStorage first (most recent data)
        const localData = JSON.parse(localStorage.getItem('csvVisitorData') || '[]');
        let visitorData = localData;
        
        // If no local data, try reading CSV file
        if (visitorData.length === 0) {
            visitorData = await readCSVFile();
        }
        
        const uniqueIPs = [...new Set(visitorData.map(visitor => visitor.ip))];
        const countElement = document.getElementById('uniqueIPCount');
        if (countElement) {
            countElement.textContent = `Unique IPs: ${uniqueIPs.length} (CSV)`;
        }
    } catch (error) {
        console.log('Error updating IP count from CSV:', error.message);
        // Fallback to old method
        updateUniqueIPCount();
    }
}
</script>

</div>

<script>
// Simple visitor counter using vanilla JS and localStorage
function updateVisitorCount() {
    // Get current count from localStorage
    let visits = parseInt(localStorage.getItem('jkCampaignVisits') || '0');
    
    // Increment visit count
    visits++;
    
    // Store updated count
    localStorage.setItem('jkCampaignVisits', visits);
    
    // Display the count
    document.getElementById('visitorCount').textContent = visits.toLocaleString();
    
    // Also store visit details
    const now = new Date();
    const visitData = {
        timestamp: now.toISOString(),
        date: now.toISOString().split('T')[0],
        time: now.toTimeString().split(' ')[0],
        hour: now.getHours().toString().padStart(2, '0'),
        minute: now.getMinutes().toString().padStart(2, '0'),
        second: now.getSeconds().toString().padStart(2, '0'),
        visitCount: visits,
        userAgent: navigator.userAgent.substring(0, 50) + '...',
        pageUrl: window.location.href.split('?')[0]
    };
    
    // Store visit details
    const visitHistory = JSON.parse(localStorage.getItem('jkVisitHistory') || '[]');
    visitHistory.push(visitData);
    
    // Keep only last 100 visits
    if (visitHistory.length > 100) {
        visitHistory.splice(0, visitHistory.length - 100);
    }
    
    localStorage.setItem('jkVisitHistory', JSON.stringify(visitHistory));
    
    console.log('Visit recorded:', visitData);
}

// IP Geolocation tracking function
async function trackVisitorIP() {
    try {
        // Get IP and location info from ipapi.co (free tier: 1000 requests/day)
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        if (data.ip) {
            // Use shared storage key
            const sharedIPKey = 'jkCampaignIPData';
            let ipData = JSON.parse(localStorage.getItem(sharedIPKey) || '[]');
            
            // Check if this specific IP was already tracked recently (within last 2 minutes for testing)
            const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000);
            const recentSameIP = ipData.find(visitor => 
                visitor.ip === data.ip && new Date(visitor.timestamp) > twoMinutesAgo
            );
            
            if (recentSameIP) {
                console.log('Same IP tracked within last 2 minutes, skipping to avoid spam');
                // Still update the IP count display even if not tracking
                if (window.location.search.includes('admin=true')) {
                    updateUniqueIPCountFromSharedData();
                    updateTotalVisitsFromSharedData();
                }
                return;
            }
            
            // Create visitor info object
            const visitorInfo = {
                timestamp: new Date().toISOString(),
                ip: data.ip,
                city: data.city || 'Unknown',
                region: data.region || 'Unknown',
                country: data.country_name || 'Unknown',
                countryCode: data.country_code || 'Unknown',
                timezone: data.timezone || 'Unknown',
                isp: data.org || 'Unknown',
                userAgent: navigator.userAgent.substring(0, 50) + '...', // Truncate
                referrer: document.referrer || 'Direct',
                pageUrl: window.location.href.split('?')[0], // Remove query params
                sessionId: generateSessionId()
            };
            
            // Add to shared IP data
            ipData.push(visitorInfo);
            
            // Keep only last 100 entries to prevent localStorage overflow
            if (ipData.length > 100) {
                ipData = ipData.slice(-100);
            }
            
            localStorage.setItem(sharedIPKey, JSON.stringify(ipData));
            
            console.log('New visitor IP tracked:', visitorInfo);            
            // Update counts if admin panel is visible
            if (window.location.search.includes('admin=true')) {
                updateUniqueIPCountFromSharedData();
                updateTotalVisitsFromSharedData();
            }
        }
    } catch (error) {
        console.log('IP tracking failed (this is normal):', error.message);
    }
}

// Generate a unique session ID for each visit
function generateSessionId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

// Function to read visitor CSV file
async function readVisitorCSVFile() {
    try {
        const response = await fetch('./visitors.csv?' + Date.now()); // Cache bust
        if (!response.ok) {
            console.log('Visitor CSV file not found, starting fresh');
            return [];
        }
        const csvText = await response.text();
        return parseVisitorCSVData(csvText);
    } catch (error) {
        console.log('Error reading visitor CSV file:', error.message);
        return [];
    }
}

// Function to parse visitor CSV data
function parseVisitorCSVData(csvText) {
    const lines = csvText.trim().split('\n');
    if (lines.length <= 1) return []; // Only header or empty
    
    const data = [];
    for (let i = 1; i < lines.length; i++) { // Skip header
        const line = lines[i].trim();
        if (line) {
            const parts = parseCSVLine(line);
            if (parts.length >= 8) {
                data.push({
                    timestamp: parts[0],
                    date: parts[1],
                    time: parts[2],
                    hour: parts[3],
                    minute: parts[4],
                    second: parts[5],
                    visitCount: parseInt(parts[6]) || 0,
                    userAgent: parts[7].replace(/^"|"$/g, ''), // Remove quotes
                    pageUrl: parts[8] || ''
                });
            }
        }
    }
    return data;
}

// Function to append visitor data to CSV file (client-side simulation)
async function appendToVisitorCSVFile(visitorEntry) {
    try {
        // Read existing data
        const existingData = await readVisitorCSVFile();
        
        // Add new visitor
        existingData.push(visitorEntry);
        
        // Store in localStorage as fallback and for immediate use
        localStorage.setItem('csvVisitorCountData', JSON.stringify(existingData));
        
        console.log('Visitor data added to local storage (CSV simulation)');
        
        return true;
    } catch (error) {
        console.log('Error appending to visitor CSV:', error.message);
        return false;
    }
}
async function readCSVFile() {
    try {
        const response = await fetch('./ips.csv?' + Date.now()); // Cache bust
        if (!response.ok) {
            console.log('CSV file not found, starting fresh');
            return [];
        }
        const csvText = await response.text();
        return parseCSVData(csvText);
    } catch (error) {
        console.log('Error reading CSV file:', error.message);
        return [];
    }
}

// Function to parse CSV data
function parseCSVData(csvText) {
    const lines = csvText.trim().split('\n');
    if (lines.length <= 1) return []; // Only header or empty
    
    const data = [];
    for (let i = 1; i < lines.length; i++) { // Skip header
        const line = lines[i].trim();
        if (line) {
            const parts = parseCSVLine(line);
            if (parts.length >= 11) {
                data.push({
                    timestamp: parts[0],
                    ip: parts[1],
                    city: parts[2],
                    region: parts[3],
                    country: parts[4],
                    countryCode: parts[5],
                    timezone: parts[6],
                    isp: parts[7],
                    userAgent: parts[8].replace(/^"|"$/g, ''), // Remove quotes
                    referrer: parts[9],
                    pageUrl: parts[10],
                    sessionId: parts[11] || 'N/A'
                });
            }
        }
    }
    return data;
}

// Simple CSV line parser that handles quoted fields
function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            result.push(current);
            current = '';
        } else {
            current += char;
        }
    }
    
    result.push(current); // Add the last field
    return result;
}

// Function to append data to CSV file (client-side simulation)
async function appendToCSVFile(visitorInfo) {
    try {
        // Read existing data
        const existingData = await readCSVFile();
        
        // Add new visitor
        existingData.push(visitorInfo);
        
        // Store in localStorage as fallback and for immediate use
        localStorage.setItem('csvVisitorData', JSON.stringify(existingData));
        
        // In a real implementation, you would send this to a server endpoint
        // For now, we'll simulate by downloading the updated CSV
        console.log('Visitor data added to local storage (CSV simulation)');
        
        // Auto-download updated CSV in admin mode
        if (window.location.search.includes('admin=true')) {
            generateCSVDownloadFromData(existingData);
        }
        
        return true;
    } catch (error) {
        console.log('Error appending to CSV:', error.message);
        return false;
    }
}

// Function to generate and download CSV file
function generateCSVDownload() {
    // Try to get data from localStorage first (most recent)
    const localData = JSON.parse(localStorage.getItem('csvVisitorData') || '[]');
    
    if (localData.length > 0) {
        generateCSVDownloadFromData(localData);
    } else {
        // Fallback to reading the CSV file
        readCSVFile().then(data => {
            if (data.length === 0) {
                alert('No visitor data available');
                return;
            }
            generateCSVDownloadFromData(data);
        });
    }
}

// Function to generate CSV download from data array
function generateCSVDownloadFromData(visitorData) {
    if (visitorData.length === 0) {
        alert('No visitor data available');
        return;
    }
    
    // Create CSV header
    const csvHeader = 'Timestamp,IP Address,City,Region,Country,Country Code,Timezone,ISP,User Agent,Referrer,Page URL,Session ID\n';
    
    // Create CSV rows
    const csvRows = visitorData.map(visitor => {
        return [
            visitor.timestamp,
            visitor.ip,
            visitor.city,
            visitor.region,
            visitor.country,
            visitor.countryCode,
            visitor.timezone,
            visitor.isp,
            `"${visitor.userAgent}"`, // Wrap in quotes for CSV
            visitor.referrer,
            visitor.pageUrl,
            visitor.sessionId || 'N/A'
        ].join(',');
    }).join('\n');
    
    // Combine header and rows
    const csvContent = csvHeader + csvRows;
    
    // Create and trigger download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `ips_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Admin function to manually download CSV (call in browser console or add admin=true to URL)
window.downloadVisitorCSV = generateCSVDownload;

// Test function to add a test IP manually
async function addTestIP() {
    const testIP = document.getElementById('testIP').value.trim();
    if (!testIP) {
        alert('Please enter a test IP address');
        return;
    }
    
    // Create a test visitor entry
    const testVisitorInfo = {
        timestamp: new Date().toISOString(),
        ip: testIP,
        city: 'Test City',
        region: 'Test Region', 
        country: 'Test Country',
        countryCode: 'TC',
        timezone: 'Test/Timezone',
        isp: 'Test ISP',
        userAgent: 'Test Browser - ' + navigator.userAgent.split(' ')[0],
        referrer: 'Manual Test Entry',
        pageUrl: window.location.href.split('?')[0],
        sessionId: generateSessionId()
    };
    
    // Add to shared IP data
    const ipData = JSON.parse(localStorage.getItem('jkCampaignIPData') || '[]');
    ipData.push(testVisitorInfo);
    localStorage.setItem('jkCampaignIPData', JSON.stringify(ipData));
    
    // Update display
    updateUniqueIPCountFromSharedData();
    updateTotalVisitsFromSharedData();
    document.getElementById('testIP').value = '';
    
    console.log('Test IP added:', testVisitorInfo);
    alert(`Test IP ${testIP} added successfully!`);
}

// Function to clear all visitor data
function clearAllData() {
    if (confirm('Are you sure you want to clear all visitor and IP data?')) {
        localStorage.removeItem('jkCampaignIPData'); // IP data
        localStorage.removeItem('jkCampaignSharedData'); // Visitor count data
        localStorage.removeItem('csvVisitorData'); // Old CSV data
        localStorage.removeItem('csvVisitorCountData'); // Old visitor count data
        localStorage.removeItem('visitorTrackingData'); // Old tracking data
        localStorage.removeItem('jkCampaignVisits'); // Old visit count
        updateUniqueIPCountFromSharedData();
        updateTotalVisitsFromSharedData();
        alert('All visitor data cleared!');
    }
}

// Update counter and track IP when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateVisitorCount();
    trackVisitorIP();
});
</script>

</body>
</html><!-- Cache bust: 06/24/2025 -->
